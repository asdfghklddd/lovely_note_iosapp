笺间（iMessage 配件版）——产品体验流程与用户旅程

一、产品定位与原则
- 定位：慢信仪式工具（Not a chat app）。借助 iMessage 作为“邮局/传输网络”，自身专注“写信—在途—到点—到家—开封”的仪式与情绪价值。
- 设计原则（参考《设计灵感》）：
  1) 牺牲效率，增强仪式感；
  2) 稀缺与等待创造价值（打字限速、周墨水上限、邮路延迟、到家方可开封）；
  3) 强调纸张肌理、书法字体、信封开封的触感与动效；
  4) 简化通信栈，把通信外包给 iMessage，自己聚焦创作与开封体验。

二、核心角色与容器
- 发送者（A）：写信、选择邮路、通过 iMessage 发送信封。
- 接收者（B）：在 iMessage 收到信封，按规则到点且到家后开封。
- 容器 App（笺间，SwiftUI）：写信、样式/皮肤、收/发信箱、到家开关、通知管理。
- iMessage 扩展：生成/展示“信封气泡”、承载最小的解锁判断与开封入口。
- 数据共享：App Groups（容器 App 与扩展共享草稿/样式/已保存信件）。

三、关键机制与规则（MVP）
- 墨水上限：每周最多 600 字（周一 00:00 重置）。UI 用“墨水条”显示剩余额。超限后需等待重置。
- 打字限速：2 字/秒（粘贴时智能节流：分段注入或按段落阈值截断 20–40 字/间隔）。
- 邮路档位（固定延迟）：同城 1 天 / 同省 3 天 / 跨省 7 天（MVP 固定值）。
- 到家开关：容器 App 内手动开关（后续可升级为地理围栏）。
- 解锁条件（AND）：当前时间 ≥ unlockAt 且 到家开关 = 开。
- 通知策略：只有“保存到 App”的信才安排本地通知（UNUserNotificationCenter）。
- 软防作弊：以系统时间为准，可选启动时做一次服务器时间快照作偏移参考；不做强校验。
- 消息负载：JSON（几 KB 内），正文必要时轻压缩+Base64；MVP 可不加密，后续用 CryptoKit 做对称加密。

四、信息架构（IA）
- 容器 App
  1) 首页：收件箱/发件箱（分段或标签切换），在途卡片显示解锁日期与倒计时。
  2) 写信：纸张纹理+书法字体，字数/墨水/限速提示，邮路档位，发送前预览。
  3) 设置：到家开关、通知权限状态、样式管理、关于/帮助。
- iMessage 扩展
  1) 新建信件/从 App 选择草稿 → 生成“信封气泡”（模板图 + 摘要文字）。
  2) 点击气泡 → 判断是否解锁 →（未到点）展示倒计时；（已到点且到家）开封阅读。
  3) 任意时刻可“保存到 App”以获得到点提醒与归档。

五、用户旅程（端到端）
1) 首次安装（A 与 B）
   - 打开容器 App → 引导页阐述理念（慢、稀缺、仪式感）
   - 请求通知权限（说明用于“达时提醒开封”）
   - 设置页可见“到家开关”（默认开启，可手动关闭）
   - 浏览示例信件与动效，理解玩法

2) A 写信（容器 App）
   - 进入“写慢信” → 选择纸张/书体 → 输入正文
   - 实时显示字数/墨水剩余，限速提示（如“正在缓缓落笔…”）
   - 选择邮路档位（1/3/7 天）→ 生成 unlockAt（基于当前系统时间）
   - 发送前预览：展示信封封面、解锁日期、寄送规则（需到家方可开封）
   - 选择“通过 iMessage 发送” → 跳转至 iMessage 扩展

3) A 生成并发送信封（iMessage 扩展）
   - 扩展读取草稿 → 生成气泡（标题：在途；副标题：X 天后可开封；缩略图：信封/邮票皮肤）
   - 插入会话 → A 选择联系人 → 发送
   - 容器 App 的“发件箱”记录该信件（状态：在途），倒计时开始

4) B 接收信封（iMessage）
   - 在对话中看到信封气泡（文本“将在 X 天后可开封”）
   - 点击气泡 → 打开扩展：
     • 若未到点：显示倒计时与规则说明，按钮“保存到笺间以获得提醒”
     • 若到点但未到家：提示“回到家中可开封”，展现柔和动画，按钮“我已到家（去 App 设置）”
     • 若到点且到家：显示“开封”按钮 → 播放开启动效 → 展示正文
   - 选择“保存到 App”后：写入共享容器 → 打开容器 App 安排本地通知并归档到“收件箱”

5) 到点提醒与开封（容器 App + 扩展）
   - 到点时，本地通知提示“信已抵达，可在家中开封”
   - 用户点通知进入容器 App 详情页：若到家开关=开 → 播放开启动效 → 阅读
   - 详情页支持“回信”（走 2–3 的流程），支持复制、收藏、印章标注

6) 回信路径
   - 在信件详情页点击“回信” → 自动带出原样式/邮票 → 重走写信与发送流程

六、状态机与转移（Letter.status）
- draft（草稿，App 内）
- staged（扩展生成待发气泡）
- sent（已在 iMessage 发送）
- in_transit（在途，未到 unlockAt）
- ready（已达时，等待到家）
- opened（已开封）
- archived（归档/已读）
状态转移：draft→staged→sent→in_transit→ready→opened→archived

七、异常与边界体验
- 未保存到 App：无法自动提醒 → 在扩展中持续提供“保存到 App”的提示与快捷入口。
- 通知权限关闭：在首页卡片与详情内显示倒计时与开封条件，不依赖通知仍可完成流程。
- 时间作弊：轻提示“为保证仪式感，请避免修改系统时间”，到点判断可参考最近一次服务器时间快照（可选）。
- 消息解析失败/过期：提供“导入到 App 尝试恢复”的选项；失败时给出温柔文案与重新发送建议。
- 内容过长：在扩展内提示“正文较长，请先保存到 App 再查看”。

八、关键交互与动效
- 信封开封：50–150ms 轻动效 + 触觉反馈，纸张展开、墨迹微扩散。
- 在途卡片：静态倒计时文本（不强求实时跳动），强调日期与邮路徽章。
- 输入动效：限速时轻呼吸动画，墨水条随输入缓慢减少。

九、文案建议（示例）
- 主要按钮：
  • 写慢信 / 放入信封并预寄 / 通过 iMessage 发送
  • 保存到笺间 / 到点开封 / 我已到家（去设置）
- 说明性文案：
  • “笺间以慢为序，每一封信都值得等待。”
  • “这封信将在 X 天后抵达，回到家里才能开封。”
  • “为保持仪式感，我们限制每周墨水 600 字与 2 字/秒的落笔速度。”

十、成功标准（MVP 可玩性）
- 两台设备通过 iMessage 完成一封信的寄送与开封，符合“达时且到家”规则。
- 写信页限速与周墨水上限准确生效；在途卡片倒计时正确。
- 保存到 App 后能准时收到本地提醒；UI 流畅无明显崩溃。

十一、MVP 范围与排除项
- 包含：文本信件、三档邮路、到家开关（手动）、本地通知、简单样式皮肤、iMessage 扩展生成/展示气泡。
- 不含（后续版本）：媒体附件、强加密/口令派生、地理围栏、实时地图/距离、复杂社交关系、多端云同步。

十二、消息负载示例（用于 iMessage 气泡）
{
  "v": 1,
  "type": "letter",
  "id": "uuid",
  "unlockAt": 1736505600,
  "requiresHome": true,
  "style": "paper-01",
  "inkUsed": 342,
  "content": "base64-utf8-正文"
}

十三、后续迭代方向
- 轻加密（CryptoKit，对称密钥或口令派生）
- 地理围栏“到家”与个性化“邮局点”
- 皮肤商店（纸张/邮票/邮路主题）与收藏系统
- iCloud 同步（跨设备）与统计面板（私密）

十四、度量与心智护栏
- 关注：发送→开封转化率、平均字数、在途放弃率、回信比例。
- 坚守：不做即时通讯与社交喧哗；持续打磨“慢、少、真、贵”的体验。

（本文档基于《设计灵感》与 iMessage 配件化思路整理，面向一周内可落地的最小可体验版本。）
